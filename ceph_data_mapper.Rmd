---
title: "ceph_data_mapper"
author: "Martin A. Gonzalez"
date: '2022-06-22'
output: html_document
Purpose: This code graphs ceph data from AK bottom trawl data from ceph_data_analyzer
---
# goals and commments
- check all count plots to ensure you're using the number_fish and not just 
  number of occurences
- fix up the gg 7 group to ensure accuracy

BS/GOA/AI Top 7
  - *Benthoctopus Leioderma*
  - *Berryteuthis magister*
  - *Enteroctopus dofleini*
  - *Gonatposis borealis*
  - Opisthoteuthis californiana
  - Rossia pacifica
  - *Sasakiopus salebrosus*
  
BS Slope Top 5
  - *Benthoctopus leioderma*
  - *Berryteuthis magister*
  - *Enteroctopus dofleini*
  - *Gonatopsis borealis*
  - *Sasakiopus saleborsus*




# libraries
```{r, include = FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
library(here)
library(stringr)
library(ggplot2)
# install.packages('devtools')
# devtools::install_github("sean-rohan-noaa/akgfmaps", build_vignettes = TRUE, R_REMOTES_NO_ERRORS_FROM_WARNINGS="true")
library(sf)
# library(akgfmaps)
# devtools::install_github("afsc-gap-products/coldpool")
# library(coldpool)
# install.packages('maps')
library(maps)
# install.packages('mapproj')
library(mapproj)
library(ggmap)
# install.packages('getPass')
library(getPass)
# install.packages('RODBC')
library(RODBC)
# install.packages('RColorBrewer')
library(RColorBrewer)
# install.packages('marmap')
library(marmap)
# install.packages('binr')
library(binr)
# install.packages('scales')
library(scales)
# install.packages('stringi')
library(stringi)
```

# get data

```{r, echo = FALSE, include = FALSE}
#here calls need to be updated
ceph_data_clean <- read.csv(here::here("output_data", "clean_ceph_data.csv"))
count_fish_per_year_region <- read.csv(here::here("output_data", "count_fish_per_year_region.csv"))
count_fish_region <- read.csv(here::here("output_data", "count_fish_region.csv"))
count_fish_year <- read.csv(here::here("output_data", "count_fish_year.csv"))
count_unique_spec <- read.csv(here::here("output_data", "count_unique_species.csv"))
berry_through_time_region <- read.csv(
  here::here("output_data", "berry_through_time_region.csv"))
dory_through_time_region <- read.csv(
  here::here("output_data", "dory_through_time_region.csv"))
summary_sst_region <- read.csv(here::here("output_data", "summary_sst_region.csv"))
summary_sst_year <- read.csv(here::here("output_data", "summary_sst_year.csv"))
tot_ceph_year <- read.csv(here::here("output_data", "tot_ceph_year.csv"))
tot_ceph_region <- read.csv(here::here("output_data", "tot_ceph_region.csv"))
summary_bot_depth_region <- read.csv(
  here::here("output_data", "summary_bot_depth_region.csv"))
tot_ceph_spec <- read.csv(here::here("output_data", "tot_ceph_spec.csv"))
lat_long_and_depth <- read.csv(here::here("output_data", "lat_long_and_depth.csv"))
summary_bot_temp_region <- read.csv(
  here::here("output_data", "summary_bot_temp_region.csv"))
summary_bot_temp_year <- read.csv(
  here::here("output_data", "summary_bot_temp_year.csv"))
tot_count_bot_and_surface_temp_region <- read.csv(
  here::here("output_data", "tot_count_bot_and_surface_temp_region.csv"))
tot_count_bot_and_surface_temp_year <- read.csv(
  here::here("output_data", "tot_count_bot_and_surface_temp_year.csv"))
tot_count_bot_and_surface_temp_year_region <- read.csv(
  here::here("output_data", "tot_count_bot_and_surface_temp_year_region.csv"))
BS_lat_long_depth_count <- read.csv(here::here("output_data", "BS_lat_long_depth_count.csv"))
all_lat_long_depth_count <- read.csv(here::here("output_data", "all_lat_long_depth_count.csv"))
tot_ceph_year_region <- read.csv(here::here("output_data", "tot_ceph_year_region.csv"))
tot_ceph_region_without_berry <- read.csv(here::here("output_data", "tot_ceph_region_without_berry.csv"))
station_data <- read.csv(here::here("output_data", "station_data.csv"))
all_spec <- read.csv(here::here("output_data", "all_spec.csv"))
clean_haul_data <- read.csv(here::here("output_data", "clean_haul_data.csv"))
haul_data <- read.csv(here::here("data", "ceph_all_hauls_ak.csv"))
survey_y_or_n <- read.csv(here::here("data", "Survey_Y_or_N_data.csv"))
clean_slope_octo_squid <- read.csv(here::here("output_data", "clean_slope_octo_squid.csv"))
```



# functions

```{r, include = FALSE}

```

# altering data for best and most statistical graphs 

``` {r, include = FALSE}

ceph_data_clean_cpue <- ceph_data_clean %>% 
  mutate(area_fished_ha = distance_fished*net_width/10) %>%
  mutate(cpue_kg_ha = weight/area_fished_ha,
         cpue_num_ha = number_fish/area_fished_ha) %>% 
  mutate(cpue_kg_ha = if_else(is.na(cpue_kg_ha), 0, cpue_kg_ha)) %>% 
  mutate(cpue_num_ha = if_else(is.na(cpue_num_ha), 0, cpue_num_ha)) %>% 
  mutate(cpue_num_ha = if_else(cpue_num_ha == 0 & cpue_kg_ha > 0, NA_real_, cpue_num_ha)) %>% 
  dplyr::filter(start_longitude < 0) %>% 
  mutate(nonzero = ifelse(cpue_num_ha == 0, "Zero", "Nonzero")) %>%   
  dplyr::filter(!is.na(family_taxon)) %>%
  dplyr::filter(!is.na(nonzero)) %>% 
  dplyr::filter(nonzero == "Nonzero") 

write_csv(x = ceph_data_clean_cpue,
          file = here::here("output_data", "ceph_data_clean_cpue.csv"))

# new top 7 species

  # 1 B. magister       = 141494
  # 2 E. dofleini       = 3601
  # 3 R. pacifica       = 2666
  # 4 B. leioderma      = 1209
  # 5 G. borealis       = 861
  # 6 O. californiana   = 781
  # 7 S. salebrosus     = 624

# special Market Squid
  # 8 D. opalescens     = 403

# 1: filtering count_fish_region for count above 100

gg_7_count_fish_region <- count_fish_region %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister" | 
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Rossia pacifica" |
                report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Sasakiopus salebrosus" |
                report_name_scientific == "Opisthoteuthis californiana" |
                report_name_scientific == "Gonatopsis borealis")

gg_7_count_fish_year <- count_fish_year %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister" | 
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Rossia pacifica" |
                report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Sasakiopus salebrosus" |
                report_name_scientific == "Opisthoteuthis californiana" |
                report_name_scientific == "Gonatopsis borealis")

gg_7_count_fish_year_region <- count_fish_per_year_region %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister" | 
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Rossia pacifica" |
                report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Sasakiopus salebrosus" |
                report_name_scientific == "Opisthoteuthis californiana" |
                report_name_scientific == "Gonatopsis borealis") %>% 
  add_row(year = 1992, region = "BS", 
          report_name_scientific = "Berryteuthis magister", 
          count_per_year_region = 0)

gg_7_tot_count_bot_and_surface_temp_year_region <- 
  tot_count_bot_and_surface_temp_year_region %>% 
    dplyr::filter(report_name_scientific == "Berryteuthis magister" | 
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Rossia pacifica" |
                report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Sasakiopus salebrosus" |
                report_name_scientific == "Opisthoteuthis californiana" |
                report_name_scientific == "Gonatopsis borealis")

join_tot_ceph_region <- full_join(tot_ceph_region, tot_ceph_region_without_berry)

gg_7_ceph_data_clean <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister" |
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Rossia pacifica" |
                report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Sasakiopus salebrosus" |
                report_name_scientific == "Opisthoteuthis californiana" |
                report_name_scientific == "Gonatopsis borealis") %>% 
    add_row(year = 1992, region = "BS", 
          report_name_scientific = "Berryteuthis magister", 
          subsample = 0,
          start_longitude = -185, start_latitude = 70)

gg_ent_dofl <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Enteroctopus dofleini") 

gg_ber_mag <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister") 

gg_dory_opal <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Loligo (=Doryteuthis) opalescens") 

gg_ross_pac <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Rossia pacifica") 

ggmar_7_ceph_data_clean <- gg_7_ceph_data_clean %>% 
  dplyr::filter(start_longitude < 0) %>% 
  mutate(nonzero = ifelse(cpue_num_ha == 0, "Zero", "Nonzero")) %>%   
  dplyr::filter(!is.na(family_taxon)) %>%
  dplyr::filter(!is.na(nonzero)) %>% 
  dplyr::filter(nonzero == "Nonzero")

ceph_family_clean <- ceph_data_clean_cpue %>% 
  dplyr::filter(!is.na(family_taxon))

coldpool_haul_data <- haul_data %>% 
  dplyr::filter(performance >= 0) %>% 
  dplyr::select(region, cruise, cruisejoin, hauljoin, distance_fished, 
                net_width, stratum, start_longitude, start_latitude, 
                gear_temperature, surface_temperature) %>% 
  mutate(year = str_extract(cruise, "^\\d{4}")) %>% 
  mutate(year = as.numeric(year)) %>% 
  dplyr::filter(year > 1982) %>% 
  dplyr::filter(gear_temperature <= 2)

ggmar_all_lat_long_depth_count <- all_lat_long_depth_count %>% 
  dplyr::filter(start_longitude < 0)

count_ceph_family <- ceph_family_clean %>% 
  group_by(family_taxon) %>% 
  dplyr::summarize(count = sum(number_fish, na.rm = TRUE))

gg_count_ceph_family <- ceph_family_clean %>% 
  group_by(year, region, family_taxon, report_name_scientific) %>% 
  dplyr::summarize(count = sum(number_fish, na.rm = TRUE)) %>% 
  arrange(year)
  
negative_station_data <- station_data %>% 
  dplyr::filter(start_longitude < 0)
    
ceph_data_bottom_clean <- ceph_data_clean %>% 
  dplyr::filter(bottom_type < 8, na.rm = TRUE) %>% 
  dplyr::select(year, region, bottom_type,
                start_longitude, start_latitude) %>% 
  group_by(year) %>% 
  arrange(year) 

station_data_slim <- station_data %>% 
  dplyr::select(year, region, bottom_type, start_longitude, start_latitude) %>% 
  dplyr::filter(bottom_type < 8, na.rm = TRUE) 


join_ceph_haul_bottom_data_clean <- full_join(ceph_data_bottom_clean, station_data_slim) %>% 
  mutate(bottom_type = as.character(bottom_type)) 

join_ceph_haul_bottom_data_clean$bottom_type <- gsub('0', 'Unidentified',
                                                gsub('1', '1: Mud',
                                                gsub('2', '2: Clay',
                                                gsub('3', '3: Sand',
                                                gsub('4', '4: Gravel',
                                                gsub('5', '5: Cobbles',
                                                gsub('6', '6: Rocky',
                                                gsub('7', '7: Boulders',
                          join_ceph_haul_bottom_data_clean$bottom_type))))))))

gg_count_family <- ceph_data_clean %>% 
  group_by(region, family_taxon) %>% 
  dplyr::filter(!is.na(family_taxon)) %>%
  dplyr::summarize(count_per_region = sum(number_fish, na.rm = TRUE)) %>% 
  arrange(desc(count_per_region))

gg_ent_ber_ross <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Berryteuthis magister" |
                report_name_scientific == "Rossia pacifica")


pres_station_data <- station_data %>% 
  dplyr::filter(start_latitude > 48) %>% 
  dplyr::filter(start_longitude < -130)

survey_y_or_n$Surveyed <- gsub('N', 'a',
                          gsub('Y', 'b',
                               survey_y_or_n$Surveyed))

survey_y_or_n$Surveyed <- gsub('a', 'No',
                          gsub('b', 'Yes',
                               survey_y_or_n$Surveyed))


```

#altering data pt 2

```{r, include = FALSE}

special_gg_ent_dofl <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Enteroctopus dofleini") %>% 
  dplyr::filter(region == "BS" | region == "AI") %>% 
  mutate(year_color_bins = as.character(year))

special_gg_ent_dofl$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_gg_ent_dofl$year_color_bins))))))))))))))))))))))))))))))))))))))

special_gg_ent_dofl$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_gg_ent_dofl$year_color_bins))

special_gg_ent_dofl$year_color_bins <- gsub('_', ' ',
                                            special_gg_ent_dofl$year_color_bins)

special_gg_ber_mag <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister") %>% 
  dplyr::filter(region == "BS" | region == "AI") %>% 
  mutate(year_color_bins = as.character(year))

special_gg_ber_mag$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_gg_ber_mag$year_color_bins))))))))))))))))))))))))))))))))))))))

special_gg_ber_mag$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_gg_ber_mag$year_color_bins))

special_gg_ber_mag$year_color_bins <- gsub('_', ' ',
                                            special_gg_ber_mag$year_color_bins)

special_gg_ross_pac <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Rossia pacifica") %>% 
  dplyr::filter(region == "BS" | region == "AI") %>% 
  mutate(year_color_bins = as.character(year))

special_gg_ross_pac$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_gg_ross_pac$year_color_bins))))))))))))))))))))))))))))))))))))))

special_gg_ross_pac$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_gg_ross_pac$year_color_bins))

special_gg_ross_pac$year_color_bins <- gsub('_', ' ',
                                            special_gg_ross_pac$year_color_bins)

special_GOA_gg_ent_dofl <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Enteroctopus dofleini") %>% 
  dplyr::filter(region == "GOA") %>% 
  mutate(year_color_bins = as.character(year))

special_GOA_gg_ent_dofl$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_GOA_gg_ent_dofl$year_color_bins))))))))))))))))))))))))))))))))))))))

special_GOA_gg_ent_dofl$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_GOA_gg_ent_dofl$year_color_bins))

special_GOA_gg_ent_dofl$year_color_bins <- gsub('_', ' ',
                                            special_GOA_gg_ent_dofl$year_color_bins)

special_GOA_gg_ber_mag <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister") %>% 
  dplyr::filter(region == "GOA") %>% 
  mutate(year_color_bins = as.character(year))

special_GOA_gg_ber_mag$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_GOA_gg_ber_mag$year_color_bins))))))))))))))))))))))))))))))))))))))

special_GOA_gg_ber_mag$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_GOA_gg_ber_mag$year_color_bins))

special_GOA_gg_ber_mag$year_color_bins <- gsub('_', ' ',
                                            special_GOA_gg_ber_mag$year_color_bins)

special_GOA_gg_ross_pac <- ceph_data_clean_cpue %>% 
  dplyr::filter(report_name_scientific == "Rossia pacifica") %>% 
  dplyr::filter(region == "GOA") %>% 
  mutate(year_color_bins = as.character(year))

special_GOA_gg_ross_pac$year_color_bins <- gsub('1983', '19 83through19 88',
                                       gsub('1984', '19 83through19 88',
                                       gsub('1985', '19 83through19 88',
                                       gsub('1986', '19 83through19 88',
                                       gsub('1987', '19 83through19 88',
                                       gsub('1988', '19 83through19 88',
                                       gsub('1989', '19 89through19 94',
                                       gsub('1990', '19 89through19 94',
                                       gsub('1991', '19 89through19 94',
                                       gsub('1992', '19 89through19 94',
                                       gsub('1993', '19 89through19 94',
                                       gsub('1994', '19 89through19 94',
                                       gsub('1995', '19 95through20 00',
                                       gsub('1996', '19 95through20 00',
                                       gsub('1997', '19 95through20 00',
                                       gsub('1998', '19 95through20 00',
                                       gsub('1999', '19 95through20 00',
                                       gsub('2000', '19 95through20 00',
                                       gsub('2001', '20 01through20 06',
                                       gsub('2002', '20 01through20 06',
                                       gsub('2003', '20 01through20 06',
                                       gsub('2004', '20 01through20 06',
                                       gsub('2005', '20 01through20 06',
                                       gsub('2006', '20 01through20 06',
                                       gsub('2007', '20 07through20 12',
                                       gsub('2008', '20 07through20 12',
                                       gsub('2009', '20 07through20 12',
                                       gsub('2010', '20 07through20 12',
                                       gsub('2011', '20 07through20 12',
                                       gsub('2012', '20 07through20 12',  
                                       gsub('2013', '20 13through20 21,_no_data_in_2020',
                                       gsub('2014', '20 13through20 21,_no_data_in_2020',
                                       gsub('2015', '20 13through20 21,_no_data_in_2020',
                                       gsub('2016', '20 13through20 21,_no_data_in_2020',
                                       gsub('2017', '20 13through20 21,_no_data_in_2020',
                                       gsub('2018', '20 13through20 21,_no_data_in_2020',
                                       gsub('2019', '20 13through20 21,_no_data_in_2020',
                                       gsub('2021', '20 13through20 21,_no_data_in_2020',
                            special_GOA_gg_ross_pac$year_color_bins))))))))))))))))))))))))))))))))))))))

special_GOA_gg_ross_pac$year_color_bins <- gsub('\\s', '',
                                       gsub('through', '-',
                              special_GOA_gg_ross_pac$year_color_bins))

special_GOA_gg_ross_pac$year_color_bins <- gsub('_', ' ',
                                            special_GOA_gg_ross_pac$year_color_bins)
```


## BS Slope alterations
```{r, include= FALSE}
gg_5_clean_slope_octo_squid <- clean_slope_octo_squid %>% 
  dplyr::filter(report_name_scientific == "Benthoctopus leioderma" |
                report_name_scientific == "Berryteuthis magister" | 
                report_name_scientific == "Enteroctopus dofleini" |
                report_name_scientific == "Gonatopsis borealis" |
                report_name_scientific == "Sasakiopus salebrosus")

bs_shelf_ggmar_7_ceph_data_clean <- ggmar_7_ceph_data_clean %>% 
  dplyr::filter(year == "2002" | year == "2004" | year == "2008" |
                year == "2010" | year == "2012" | year == "2016" ) %>% 
  dplyr::filter(region == "BS") %>% 
  dplyr::filter(start_latitude < "62" & start_latitude > "50") %>% 
  dplyr::filter(start_longitude < "-180" & start_longitude > "-160")


slope_octo_squid_bot_temp_bin <- gg_5_clean_slope_octo_squid  %>%
  mutate(bot_temp_color_bins = as.character(gear_temperature))

slope_octo_squid_bot_temp_bin$bot_temp_color_bins <- gsub('2.1', '_two_point0through_two_point_four_',
                                                     gsub('2.2', '_two_point0through_two_point_four_',
                                                     gsub('2.3', '_two_point0through_two_point_four_',
                                                     gsub('2.4', '_two_point0through_two_point_four_',
                                                     gsub('2.5', '_two_point5through_two_point9',
                                                     gsub('2.6', '_two_point5through_two_point9',
                                                     gsub('2.7', '_two_point5through_two_point9',
                                                     gsub('2.8', '_two_point5through_two_point9',
                                                     gsub('2.9', '_two_point5through_two_point9',
                                                     gsub('3.1', '_three_point0through_three_point_four_',
                                                     gsub('3.2', '_three_point0through_three_point_four_',
                                                     gsub('3.3', '_three_point0through_three_point_four_',
                                                     gsub('3.4', '_three_point0through_three_point_four_',
                                                     gsub('3.5', '_three_point5through_three_point9',
                                                     gsub('3.6', '_three_point5through_three_point9',
                                                     gsub('3.7', '_three_point5through_three_point9',
                                                     gsub('3.8', '_three_point5through_three_point9',
                                                     gsub('3.9', '_three_point5through_three_point9',
                                                     gsub('4.1', '_four_point0through_four_point6',
                                                     gsub('4.2', '_four_point0through_four_point6',
                                                     gsub('4.2', '_four_point0through_four_point6',
                                                     gsub('4.3', '_four_point0through_four_point6',
                                                     gsub('4.4', '_four_point0through_four_point6',
                                                     gsub('4.5', '_four_point0through_four_point6',
                                                     gsub('4.6', '_four_point0through_four_point6',
           slope_octo_squid_bot_temp_bin$bot_temp_color_bins)))))))))))))))))))))))))

slope_octo_squid_bot_temp_bin$bot_temp_color_bins <- gsub('2', '_two_point0through_two_point_four_',
                                                     gsub('3', '_three_point0through_three_point_four_',
                                                     gsub('4', '_four_point0through_four_point6',
                                        slope_octo_squid_bot_temp_bin$bot_temp_color_bins))) 

slope_octo_squid_bot_temp_bin$bot_temp_color_bins <- gsub('point', '.',
                                                     gsub('through', '-',
                                                     gsub('_two_', '2',
                                                     gsub('_three_', '3',
                                                     gsub('_four_', '4',
                                       slope_octo_squid_bot_temp_bin$bot_temp_color_bins))))) 

slope_octo_squid_bot_temp_bin$bot_temp_color_bins <- 
                                  slope_octo_squid_bot_temp_bin$bot_temp_color_bins %>% 
  replace_na('No Bottom Temp Data')                                                          
                                                          

quick_slope_octo_squid <- slope_octo_squid_bot_temp_bin %>% 
  mutate(number_fish = count, start_longitude = longitude, start_latitude = latitude) %>% 
  dplyr::select(-srvy, -survey, -survey_ID, -station, -vessel_name, -count, 
                -longitude, -latitude, -cpue_kg_km2, -area_swept_ha, -common_name)

all_bs_data <- full_join(quick_slope_octo_squid, gg_7_ceph_data_clean) %>% 
  dplyr::select(-cruisejoin, -hauljoin, -haul_type, -performance, -start_time, -duration, 
                -stationid, -bottom_type, -gear, -accessories, -subsample, -abundance_haul, 
                -family_taxon, -area_fished_ha, -nonzero) %>% 
  dplyr::filter(region == "BS" | region == "BS Slope")  

all_bs_data$region <- gsub('BS Slope', 'temp1',
                           all_bs_data$region)

all_bs_data$region <- gsub('BS', 'temp2',
                           all_bs_data$region)

all_bs_data$region <- gsub('temp1', 'BS Slope',
                      gsub('temp2', 'BS Shelf',
                           all_bs_data$region))
bs_slope_b_mag <- slope_octo_squid_bot_temp_bin %>% 
  dplyr::filter(report_name_scientific == "Berryteuthis magister")


```

# graphing & mapping 
## ggplot graphs

--make it a log scale??

```{r, fig.width = 5, fig.height = 5, echo =FALSE}

# pres / check: survey performed tester?



ggplot(data = survey_y_or_n, 
       aes(x = Year, y = Region, group = Surveyed)) + 
  geom_point(aes(color = Surveyed, fill = Surveyed)) + 
    scale_color_manual(
      values = c("#d11141", "#00b159"))+
    scale_fill_manual(
      values = c("#d11141", "#00b159")) + 
  labs(title = "Was There a Survey Ocurring During This Year?")

ggsave(here::here("figures", "survey_yes_or_no.jpg"))

```

```{r, fig.width = 14, echo = FALSE}
# 1: bar graph species count vs region, faceted by unique species (count >100)

ggplot(data = gg_7_count_fish_region,
       aes(x = region, y = count_per_region, group = report_name_scientific)) +
  geom_col(aes(color = region, 
               fill = region)) + 
  labs(x = "Region", y = "Count per Region (log 2 scale)", 
       title = "Top 7 Species Count vs Region",
       fill = "Region", color = "Region") + 
  facet_wrap(~ report_name_scientific, ncol = 7) +
  scale_y_continuous(trans = 'log2')

ggsave(here::here("figures", "Top_7_Species_count_vs_Region.jpg"))


# 24: bar graph family vs region

ggplot(data = gg_count_family,
       aes(x = region, y = count_per_region, group = family_taxon)) + 
  geom_col(aes(color =region, fill = region)) + 
  labs(x = "Region", y = "Count per Region (log 2 scale)", title = "Family Count vs Region",
       fill = "Region", color = "Region") + 
  facet_wrap(~family_taxon) + 
    scale_y_continuous(trans = 'log2') 

ggsave(here::here("figures", "Family_count_vs_region.jpg"))
```

- log scale?
```{r, echo = FALSE}
# 2: line graph species count vs year, shows changes throuh time in all regions

ggplot(data = gg_7_count_fish_year,
       aes(x = year, y = tot_num_fish, group = report_name_scientific)) + 
  geom_line(aes(color = report_name_scientific), lwd = 1.25) +
  labs(x = "year", y = "count per year", title = "Species Count per Year vs Time",
       subtitle = "Focuses on top 7 numerous species") +
  scale_y_continuous(trans = 'log10')


ggsave(here::here("figures", "Top_7_Species_Count_per_Year_vs_Time.jpg"))

```

``` {r, echo = FALSE}
# 3: line graph of species count over time, separated into regions 

ggplot(data = gg_7_count_fish_year_region,
       aes(x = year, y= count_per_year_region, group = report_name_scientific)) + 
  geom_line(aes(color = report_name_scientific), lwd = 1) + 
  labs(x = "Year", y = "Count per year", title = "Species count over time",
       subtitle = "Separated by region") + 
  facet_wrap(~region) +
  scale_y_continuous(trans = 'log10')


ggsave(here::here("figures", "Species_count_over_time_per_region.jpg"))

# 4.1: line graph showing changes of mean SST and mean bottom temp for top 7 throug time
    # cut out??
# 
# ggplot(data = gg_7_tot_count_bot_and_surface_temp_year,
#        aes(x = year,  y = mean_bottom_temperature, group = report_name_scientific)) + 
#   geom_line(aes(color = report_name_scientific), lwd = 1.25) 

# 4.2: line graphs show changes of mean bottom temp for top 7 
  # through time separated by region

ggplot(data = gg_7_tot_count_bot_and_surface_temp_year_region,
       aes(x = year,  y = mean_bottom_temperature, group = report_name_scientific)) + 
  geom_line(aes(color = report_name_scientific), lwd = 0.75) +
  labs(x = "Year", y = "Mean bottom temperature", 
       title = "Change of mean bottom temperature during catch through time",
       subtitle = "Focuses on top 7 numerous species") +
  facet_wrap(~region)

ggsave(here::here("figures", "Top_7_change_of_mean_bottom_temp_during_catch_throuh_time.jpg"))

# 4.3: line graphs show changes of mean SST temp for top 7 
  # through time separated by region

ggplot(data = gg_7_tot_count_bot_and_surface_temp_year_region,
       aes(x = year,  y = mean_sea_surface_temperature, group = report_name_scientific)) + 
  geom_line(aes(color = report_name_scientific), lwd = 0.75) +
  labs(x = "Year", y = "Mean sea surface temperature", 
       title = "Change of mean sea surface temperature during catch through time",
       subtitle = "Focuses on top 7 numerous species") +
  facet_wrap(~region)

ggsave(here::here("figures", "Top_7_change_of_mean_sea_surface_temp_during_catch_throuh_time.jpg"))

 
```

```{r echo =  FALSE}
# 5: line graph showing changes of total ceph caught over time (all regions)

ggplot(data = tot_ceph_year,
       aes(x = year, y = count_all_fish_per_year)) + 
  geom_line(lwd = 1.25) + 
  labs(x = "Year", y = "count of cephalopods per year", 
       title = "Changes of total cephalopods caught over time",
       subtitle = "All regions and all cephalopods (not just top 7)")
  

ggsave(here::here("figures", "Changes_of_total_cephalopods_caught_over_time.jpg"))


# 8: changes of total cephalopods caught over time, split into regions

ggplot(data = tot_ceph_year_region,
       aes(x = year, y  = count)) + 
  geom_line(lwd = 1) + 
  facet_wrap(~region) +
  labs(x = "Year", y = "Cephalopod Count (log 2 scale)", 
     title = "Change of Cephalopod Catch Over Time") + 
  scale_y_continuous(trans = 'log2')

ggsave(here::here("figures", "Cephalopod_catch_over_time.jpg"))


# 9.1: total cephalopods caught in each region

ggplot(data = tot_ceph_region,
       aes(x = region, y = count_all_fish_per_region, 
           fill = region, color = region)) +
  geom_col() +
  labs(x = "Region", y = "Cephalopod Count", color = "Region",
       fill = "Region",
       title = "Total Cephalopod Catch per Region Over All Time")

ggsave(here::here("figures", "total_cephalopod_catch_per_region_over_time.jpg"))

# 9.2: total cephalopods caught in each region, with and without berry

ggplot(data = join_tot_ceph_region,
       aes(x = region, y = count_all_fish_per_region)) + 
  geom_col() + 
  labs(x = "Region", y = "Cephalopod Count (without Berryteuthis magister",
       title = "total cephalopod catch per region over all time, 
                with and without Berryteuthis magister count")

ggsave(here::here("figures", "total_cephalopod_catch_per_region_over_time_with&without_berry.jpg"))

# 10.1: all ceph count per region, fecet by year
  # to see when survey conducted or not
# - log
ggplot(data = count_fish_per_year_region,
       aes(x = region, y = count_per_year_region)) + 
  geom_col(aes(fill = region)) + 
  facet_wrap(~year) + 
  labs(x = "Region", y = "Cephalopod Count (all)", 
       title = "All Cephalopod Count per region, separated by year")

ggsave(here::here("figures", "all_ceph_count_per_region_facet_year.jpg"))

# 10.2: top 7 ceph count per region, facet by year
# - log

ggplot(data = gg_7_count_fish_year_region,
       aes(x = region, y = count_per_year_region)) + 
  geom_col(aes(fill = region)) + 
  facet_wrap(~year) + 
  labs(x = "Region", y = "Cephalopod Count (top 7)", 
       title = "Top 7 Cephalopod Count per region, separated by year")

ggsave(here::here("figures", "top_7_ceph_count_per_region_facet_year.jpg"))

# 19.1: all ceph family graph tot 


# 19.2: all ceph family graph over time (sep by region)
# - log
ggplot(data = gg_count_ceph_family,
       aes(x = year,  y = count)) + 
  geom_line(aes(color = family_taxon), lwd = 0.75) +
  labs(x = "Year", y = "Count Ceph Family", 
       title = "Count ceph family per year seperated by regoin") +
  facet_wrap(~region)

ggsave(here::here("figures", "family_count_per_year_per_region.jpg"))
  
# ggplot(data = gg_berry_all_lat_long_depth_count,
#        aes(x = -abs(LONGITUDE), y = LATITUDE)) 
# 


```

## station maps
```{r, fig.height = 20, fig.width = 20, echo = FALSE}

# 11.1 station mapper w/ my stuff
  
  AK_location <- c(-180, 48, -130, 70)
  
  ak_map_base <- get_map(location = AK_location, source = "stamen", 
                         maptype = "toner-lite", crop = FALSE)
  
  AK_location_slim <- c(-180, 48,-130, 65)
  
  ak_map_base_slim <- get_map(location = AK_location_slim, source = "stamen", 
                              maptype = "toner-lite", crop = FALSE)
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude), data = negative_station_data,
               alpha = 0.25, color = "red", size = 0.25) + 
    facet_wrap(~year) +
    labs(x = "Longitude", y = "Latitude", 
         title = "station map")
  
  ggsave(here::here("figures", "station_map_by_year.jpg"))
  
# 11.2 station mapper all time
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude), data = negative_station_data,
               alpha = 0.5, color = "red", size = 0.75) + 
    labs(x = "Longitude", y = "Latitude", 
         title = "station map")
  
  ggsave(here::here("figures", "station_map_all_time.jpg"))
  
# 11.3.1 station mapper and bathymetry
  
  station_map_bathy <- getNOAA.bathy(lon1 = -180, lon2 = -118,
                                     lat1 = 30, lat2 = 78, 
                                     resolution = 1)  
  
  station_map_plot =  autoplot.bathy(station_map_bathy, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")
 
  station_map_plot +
  geom_point(aes(x = start_longitude, y = start_latitude), data = negative_station_data,
               alpha = 0.5, color = "red", size = 0.75) + 
  labs(x = "Longitude", y = "Latitude", 
         title = "station map") 
  
  ggsave(here::here("figures", "station_map_and_bathymetry.jpg"))
  
# 11.3.2 station mapper and bathymetry slim and for presentation
  
  pres_station_map_bathy <- getNOAA.bathy(lon1 = -180, lon2 = -130,
                                          lat1 = 48, lat2 = 78, 
                                          resolution = 1)  
  
  pres_station_map_plot =  autoplot.bathy(pres_station_map_bathy, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")
 
  pres_station_map_plot +
  geom_point(aes(x = start_longitude, y = start_latitude), data = pres_station_data,
               alpha = 0.5, color = "red", size = 0.75) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "Station and Locations Map") 
  
  ggsave(here::here("figures", "pres_station_map_and_bathymetry.jpg"))

```

## ggmap distribution and abundance
```{r, fig.height = 20, fig.width = 20, echo = FALSE}

# 12.1 top 7 species distribution by year
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, color = report_name_scientific), 
               data = gg_7_ceph_data_clean, alpha = .5, 
               size = 0.5) + 
    facet_wrap(~year) +
    labs(x = "Longitude", y = "Latitude", 
         title = "top 7 species distribution by year")
  
  ggsave(here::here("figures", "top_7_species_distribution.jpg"))

# 12.2 all species distribution by year
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude), 
               data = all_lat_long_depth_count, alpha = .5, 
               color = "orange", size = 0.5) + 
    facet_wrap(~year) +
    labs(x = "Longitude", y = "Latitude", 
         title = "all species distribution by year")
  
  ggsave(here::here("figures", "all_species_distribution.jpg"))
  
# 13.1 top 7 species abundance by year (through subsample) 
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   color = report_name_scientific, size = cpue_num_ha),
               data = gg_7_ceph_data_clean, alpha = .33) +
    facet_wrap(~year) +
    labs(x = "Longitude", y = "Latitude", 
         title = "top 7 species abundance by year")
  
  ggsave(here::here("figures", "top_7_abundance.jpg"))
  
# 13.2 all species abundance by year (through subsample)

  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, size = cpue_num_ha),
               data = ceph_data_clean_cpue, color = "darkred", 
               alpha = .33) +
    facet_wrap(~year) +
      labs(x = "Longitude", y = "Latitude", 
         title = "all species abundance by year")
  
  ggsave(here::here("figures", "all_species_abundance.jpg"))

# 14.2 abundance of all ceph, separated by year, size coded by depth
  
# 15.1: family distribution of region per year

  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = family_taxon), 
             data = ceph_family_clean, alpha = .75, 
             size = 0.5) + 
  facet_wrap(~year) +
  labs(x = "Longitude", y = "Latitude", 
       title = "Family distribution by year")
  
    ggsave(here::here("figures", "family_distribution_by_year.jpg"))
    
# 15.2: family abundance of region per year

  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = family_taxon, size = cpue_num_ha), 
             data = ceph_family_clean, alpha = .33) + 
  facet_wrap(~year) +
  labs(x = "Longitude", y = "Latitude", 
       title = "Family abundance by year")
  
    ggsave(here::here("figures", "family_abundance_by_year.jpg"))

```

## coldpool maps
```{r, fig.height = 20, fig.width = 20, echo = FALSE}
  
# 16.1 Cold pool graph gen per year
  
  
  # defunct, hard to look at
  # ggmap(ak_map_base) +
  # stat_density_2d(
  #   data = coldpool_haul_data,
  #   aes(x = start_longitude, y = start_latitude, fill = stat(level)),
  #   bins = 60, alpha = 0.2, geom = "polygon") + 
  #   scale_fill_gradientn(colors = brewer.pal(5, "Purples"))+
  #   facet_wrap(~year)
  
  ggmap(ak_map_base_slim) +
  stat_density_2d(
    data = coldpool_haul_data,
    aes(x = start_longitude, y = start_latitude),
    bins = 60, alpha = 0.2, geom = "polygon", fill = "blue") + 
    facet_wrap(~year)  +
  labs(x = "Longitude", y = "Latitude", 
       title = "General Cold pool map")
  
  
  ggsave(here::here("figures", "cold_pool_map.jpg"))

  
# 16.2 Cold pool graph + top 7 species distribution

  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, color = report_name_scientific), 
             data = gg_7_ceph_data_clean, alpha = 1, 
             size = 0.5) + 
    stat_density_2d(
    data = coldpool_haul_data,
    aes(x = start_longitude, y = start_latitude),
    bins = 60, alpha = 0.2, geom = "polygon", fill = "blue")+
             facet_wrap(~year) +
  labs(x = "Longitude", y = "Latitude", 
       title = "top 7 species distribution by year with cold pool overlay")
  
  ggsave(here::here("figures", "cold_pool_map_&_top_7_spec_distribution.jpg"))
  
# 16.3 Cold pool graph + all species distribution

  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude), 
               data = ceph_data_clean_cpue, alpha = .5, 
               color = "orange", size = 0.5) + 
    facet_wrap(~year) +
    stat_density_2d(
              data = coldpool_haul_data,
              aes(x = start_longitude, y = start_latitude),
              bins = 60, alpha = 0.2, geom = "polygon", fill = "blue")+
    labs(x = "Longitude", y = "Latitude", 
         title = "all species distribution by year with cold pool overlay")
  
  ggsave(here::here("figures", "cold_pool_map_&_all_spec_distribution.jpg"))

  
# 16.4 Cold pool graph + family species distribution 

  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = family_taxon), 
             data = ceph_data_clean_cpue, alpha = .75, 
             size = 0.5) + 
  facet_wrap(~year) +
    stat_density_2d(
        data = coldpool_haul_data,
        aes(x = start_longitude, y = start_latitude),
        bins = 60, alpha = 0.2, geom = "polygon", fill = "blue")+
  labs(x = "Longitude", y = "Latitude", 
       title = "Family distribution by year with cold pool overlay")
  
  ggsave(here::here("figures", "cold_pool_map_&_all_fam_distribution.jpg"))
  

# 16.5 Cold pool graph + all species abundance
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, size = cpue_num_ha), 
               data = ceph_data_clean_cpue,  
               color = "darkred", alpha = .33) + 
    facet_wrap(~year) +
    stat_density_2d(
              data = coldpool_haul_data,
              aes(x = start_longitude, y = start_latitude),
              bins = 60, alpha = 0.2, geom = "polygon", fill = "blue")+
    labs(x = "Longitude", y = "Latitude", 
         title = "all species abundance by year with cold pool overlay")
  
  ggsave(here::here("figures", "cold_pool_map_&_all_spec_abundance.jpg"))
  


# 17 all Temperature map?
    # need help making sure it is correct

  # ggmap(ak_map_base) + 
  # stat_density_2d(
  #             data = clean_haul_data,
  #             aes(x = start_longitude, y = start_latitude, fill = stat(level)),
  #             bins = 100, alpha = 0.2, geom = "polygon") + 
  #             scale_fill_gradientn(colors = brewer.pal(8, "Purples")) +
  # facet_wrap(~year)
  


```

```{r, fig.height = 12, fig.width = 20, echo = FALSE}
# 16.5 Cold pool graph + top 7 species abundance

  ggmap(pres_ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = report_name_scientific, size = cpue_num_ha), 
             data = gg_7_ceph_data_clean, alpha = 1) + 
    stat_density_2d(
    data = coldpool_haul_data,
    aes(x = start_longitude, y = start_latitude),
    bins = 60, alpha = 0.2, geom = "polygon", fill = "blue")+
             facet_wrap(~year) +
  labs(x = "Longitude", y = "Latitude", 
       title = "Top 7 Species Abundance by Year with Cold Pool Overlay",
       color = "Report Name Scientific", size = "CPUE, Number per Hectare")
  
  ggsave(here::here("figures", "cold_pool_map_&_top_7_spec_abundance.jpg"))
```

## bathymetry maps
### gen bath, all/family/7spec dist & abund
```{r, fig.height = 20, fig.width = 20, echo = FALSE}

# 18.1 bathymetry marmap and getting bathy data 
  
  AK_bathy <- getNOAA.bathy(lon1 = -180, lon2 = -130,
                            lat1 = 48, lat2 = 75, 
                            resolution = 1)  
  AK_bathy_plot = autoplot.bathy(AK_bathy, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")
  
  AK_bathy_slim <- getNOAA.bathy(lon1 = -180, lon2 = -130,
                            lat1 = 48, lat2 = 65, 
                            resolution = 1)
  
  AK_bathy_plot_slim = autoplot.bathy(AK_bathy_slim, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")

  # plot(AK_bathy, image = TRUE)
  # scaleBathy(AK_bathy, deg = 2, x = "bottomleft", inset = 5)
  
  

# 18.2.1 marmap + ggmap bathymetry & species distribution combo map
  # plot =
  
  AK_bathy_plot +
    geom_point(aes(x = start_longitude, y = start_latitude), 
               data = ceph_data_clean_cpue, alpha = 1, 
               color = "orange", size = 0.75) + 
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "marmap bathymetry + all species distribution all time")  

  ggsave(here::here("figures", "bathy_&_all_distribution_all_time.jpg"))
  
# 18.2.2 marmap + ggmap bathymetry & family distribution combo map

  AK_bathy_plot +
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   color = family_taxon), 
               data = ceph_data_clean_cpue, alpha = 1,
               size = 0.75) + 
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "marmap bathymetry + all family distribution all time")  

  ggsave(here::here("figures", "bathy_&_family_distribution_all_time.jpg"))
  
# 18.2.2.1 marmap + ggmap bathymetry & family distribution combo map with fancy shapes
  
    AK_bathy_plot+
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   color = family_taxon, shape = family_taxon), 
               data = ceph_data_clean_cpue, alpha = 1,
               size = 0.75) + 
    scale_shape_manual(values = 1:12) +
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "marmap bathymetry + all family distribution all time")  

  ggsave(here::here("figures", "SHAPES_bathy_&_family_distribution_all_time.jpg"))
  
# 18.2.3 marmap + ggmap bathymetry & top 7 spec distribution
  
  AK_bathy_plot+
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   color = report_name_scientific), 
               data = ggmar_7_ceph_data_clean, alpha = 1,
               size = 0.75) + 
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "marmap bathymetry + all family distribution all time")  

  ggsave(here::here("figures", "bathy_&_top_7_species_distribution_all_time.jpg"))
  
# 18.3.1 marmap + ggmap bathymetry & species abundance combo map, cpue_num_ha 
  
  AK_bathy_plot +
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   size = cpue_num_ha), 
               data = ceph_data_clean_cpue, 
               color = "darkred", alpha = .5) + 
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "marmap bathymetry + all species abundance all time",
         size = "CPUE, Number per Hectare", color = "Family")  

  ggsave(here::here("figures", "bathy_&_all_abundance_all_time.jpg"))
  
# 18.3.2 marmap + ggmap bathymetry & family abundance combo map, cpue_num_ha 
  
  AK_bathy_plot +
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   color = family_taxon, 
                   size = cpue_num_ha), 
               data = ceph_data_clean_cpue, alpha = .5) + 
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "Bathymetry & All Families' Abundance Througout All Time",
                  size = "CPUE, Number per Hectare", color = "Family")

  ggsave(here::here("figures", "bathy_&_family_abundance_all_time.jpg"))  
  
  

```

```{r, fig.width = 20, echo = FALSE}
# 18.3.3 marmap + ggmap bathymetry & gg7 species abundance, cpue_num_ha

  pres_ggmar_7_ceph_data_clean <- ggmar_7_ceph_data_clean %>% 
    dplyr::filter(start_latitude < 65)
    
  AK_bathy_plot_slim + 
    geom_point(aes(x = start_longitude, y = start_latitude,
                   color = report_name_scientific,
                   size = cpue_num_ha),
               data = pres_ggmar_7_ceph_data_clean, alpha = .75) +
    labs(x = "Longitude", y = "Latitude", fill = "Elevation",
         title = "Bathymetry & Top 7 Species' Abundance Througout All Time",
         size = "CPUE, Number per Hectare", color = "Report Name Scientific") 
  
  ggsave(here::here("figures", "bathy_&_top_7_species_abundance_all_time.jpg"))
```

### Ent Dofl, Ber Mag, Dory Opal, Ross Pac, prescombo dist & abund
```{r, fig.width = 20, echo = FALSE}

  AK_bathy_slim <- getNOAA.bathy(lon1 = -180, lon2 = -130,
                            lat1 = 48, lat2 = 65, 
                            resolution = 1)  
  AK_bathy_plot_slim = autoplot.bathy(AK_bathy_slim, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")

# 23.1.2 Enteroctopus Dofleini / Pacific Octopus cpue_num_ha + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha),
             data = gg_ent_dofl, alpha = .5, color = "#93AA00") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Enteroctopus dofleini CPUE_num_ha + bathymetry all time")

ggsave(here::here("figures", "bathy_&_enteroctopus_dofleini_cpue_num_ha_all_time.jpg"))

# 23.1.2 Enteroctopus Dofleini / Pacific Octopus num_fish + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = number_fish),
             data = gg_ent_dofl, alpha = .5, color = "#93AA00") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Enteroctopus dofleini Number Fish + bathymetry all time")

ggsave(here::here("figures", "bathy_&_enteroctopus_dofleini_num_fish_all_time.jpg"))

# 23.2.1 Berryteuthis magister cpue_num_ha + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha),
             data = gg_ber_mag, alpha = .5, color = "#D39200") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Berryteuthis magister CPUE_num_ha + bathymetry all time")

ggsave(here::here("figures", "bathy_&_berryteuthis_magister_cpue_num_ha_all_time.jpg"))

# 23.2.2 Berryteuthis magister num_fish + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = number_fish),
             data = gg_ber_mag, alpha = .5, color = "#D39200") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Berryteuthis magister Number fish + bathymetry all time")

ggsave(here::here("figures", "bathy_&_berryteuthis_magister_num_fish_time.jpg"))

# 23.3.1 Dorryteuthis opalescens cpue_num_ha + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha),
             data = gg_dory_opal, alpha = .5, color = "#00798c") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Dorryteuhtis opalescens CPUE_num_ha + bathymetry all time")

ggsave(here::here("figures", "bathy_&_dorryteuthis_opalescens_cpue_num_ha_all_time.jpg"))

# 23.3.2 Dorryteuthis opalescens num_fish + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = number_fish),
             data = gg_dory_opal, alpha = .5, color = "#00798c") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Dorryteuhtis opalescens number fish + bathymetry all time")

ggsave(here::here("figures", "bathy_&_dorryteuthis_opalescens_number_fish_all_time.jpg"))

# 23.4.1 Rossia Pacificia cpue_num_ha + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha),
             data = gg_ross_pac, alpha = .5, color = "#DB72FB") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Rossia pacifica CPUE_num_ha + bathymetry all time")

ggsave(here::here("figures", "bathy_&_rossia_pacifica_cpue_num_ha_all_time.jpg"))

# 23.4.2 Rossia Pacifica num_fish + bathymetry

AK_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = number_fish),
             data = gg_ross_pac, alpha = .5, color = "#DB72FB") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Rossia pacifica number fish + bathymetry all time")

ggsave(here::here("figures", "bathy_&_rossia_pacifica_number_fish_all_time.jpg"))

# 25 Rossia pacifica + Berrytuehtis magister + Enteroctopus dofleini top 3 per family
#   combo abundance map + bathymetry

AK_bathy_plot_slim + 
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = report_name_scientific),
             data = gg_ent_ber_ross, alpha = .75) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       color = "Report Name Scientific", size = "CPUE, Number per Hectare",
       title = "Berryteuthis magister, Enteroctopus Dofleini, Rossia pacifica: CPUE Number per Hectare and Bathymetry, All Time") + 
  scale_color_manual(
    values = c("#D39200", "#93AA00", "#DB72FB"))

ggsave(here::here("figures", "bathy_&_rossia_berrytheuthis_enteroctopus_cpue_num_ha_all_time.jpg"))


```

### Ent Dofl BS: deepdive thru time
```{r, fig.width = 8, fig.height = 10, echo = FALSE}
# Special: to look at the change of Ent Dofl throuhgout time as it doesn't match up  
  AK_BS_bathy_slim <- getNOAA.bathy(lon1 = -180, lon2 = -160,
                                    lat1 = 48, lat2 = 65, 
                                    resolution = 1)  
  AK_BS_bathy_plot_slim = autoplot.bathy(AK_BS_bathy_slim, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")
  
  AK_BS_location <- c(-180, 48, -160, 65)
  
  ak_bs_map_base <- get_map(location = AK_BS_location, source = "stamen", 
                         maptype = "toner-lite", crop = FALSE)
  
# Special a: all time, just BS and AI regions with bathymetry
  
  AK_BS_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha),
             data = special_gg_ent_dofl, alpha = .5, color = "93AA00") + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Enteroctopus dofleini CPUE_num_ha + bathymetry all time") 

  ggsave(here::here("figures", "special_BSAI_bathy_&_enteroctopus_dofleini_cpue_num_ha_all_time.jpg"))
  
# Special Ent Dofl BSAI C.1: each color = every 5ish years
  
    AK_BS_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ent_dofl, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Enteroctopus dofleini abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_BSAI_bathy_&_enteroctopus_dofleini_cpue_num_ha_6_years.jpg"))
  
# Special Ent Dofl BSAI C.2: each color = every 5ish years, faceted
  
  ggmap(ak_bs_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ent_dofl, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Enteroctopus dofleini abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_BSAI_bathy_&_enteroctopus_dofleini_cpue_num_ha_6_years.jpg"))
  
# special D: ggplot of ent dofl separated by year 

#   ggplot(data = special_gg_ent_dofl,
#        aes(x = , y = , group = report_name_scientific)) +
#   geom_col(aes(color = region, 
#                fill = region)) + 
#   labs(x = "Region", y = "Count per Region (log 2 scale)", 
#        title = "Top 7 Species Count vs Region",
#        fill = "Region", color = "Region") + 
#   facet_wrap(~ report_name_scientific, ncol = 7) +
#   scale_y_continuous(trans = 'log2')
# 
# ggsave(here::here("figures", "Top_7_Species_count_vs_Region.jpg"))

```

```{r, fig.width = 12, fig.height = 15, echo = FALSE}

# Special b: facet by year, BS and maybe AI regions to see change throhg time 
    ## can also do somethign with color per each 4-5 years to see if there is change 
    ## remember about sampling areas throuhgout the years

    ggmap(ak_bs_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   size = cpue_num_ha),
               data = gg_7_ceph_data_clean, alpha = .5, color = "#93AA00") +
    facet_wrap(~year) +
    labs(x = "Longitude", y = "Latitude", 
         title = "Enteroctopus doflieni abundance by year, focusing on BS region")
  
  ggsave(here::here("figures", "ent_dofl_abundance_per_year.jpg"))

```

####Ent Dofl: GOA: deepdive thru time
```{r, fig.width = 20, fig.height = 7, echo = FALSE}


  AK_GOA_bathy_slim <- getNOAA.bathy(lon1 = -170, lon2 = -130,
                                    lat1 = 50, lat2 = 60, 
                                    resolution = 1)  
  AK_GOA_bathy_plot_slim = autoplot.bathy(AK_GOA_bathy_slim, geom=c("tile", "contour")) +
    scale_fill_gradient2(low = "dodgerblue4", mid = "gainsboro", high = "darkgreen")
  
  AK_GOA_location <- c(-170, 50, -130, 60)
  
  ak_goa_map_base <- get_map(location = AK_GOA_location, source = "stamen", 
                         maptype = "toner-lite", crop = FALSE)
  
# SPecial Ent Dofl GOA A.1: each color = every 5ish years, faceted  

      AK_GOA_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ent_dofl, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Enteroctopus dofleini abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_GOA_bathy_&_enteroctopus_dofleini_cpue_num_ha_6_years.jpg"))
  
# SPecial Ent Dofl GOA A.2: each color = every 5ish years, faceted  
  
    ggmap(ak_goa_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ent_dofl, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Enteroctopus dofleini abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_GOA_bathy_&_enteroctopus_dofleini_cpue_num_ha_6_years.jpg"))

```


###Ber Mag BS: deepdive thru time
```{r, fig.width = 8, fig.height = 10, echo = FALSE}
# Special Ber Mag BSAI A.1: each color = every 5ish years
    AK_BS_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ber_mag, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Berrytuethis magister abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_BSAI_bathy_&_berryteuthis_magister_cpue_num_ha_6_years.jpg"))
  
# Special Ber Mag BSAI A.2: each color = every 5ish years, faceted
  
  ggmap(ak_bs_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ber_mag, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Berrytuethis magister abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_BSAI_bathy_&_berryteuthis_magister_cpue_num_ha_6_years.jpg"))


```

#### Ber Mag GOA: deepdive thru time

```{r, fig.width = 20, fig.height = 7, echo = FALSE}

# SPecial Ber Mag GOA A.1: each color = every 5ish years, faceted  

    AK_GOA_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ber_mag, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Berryteuthis magister abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_GOA_bathy_&_berryteuthis_magister_cpue_num_ha_6_years.jpg"))
  
# SPecial Ent Dofl GOA A.2: each color = every 5ish years, faceted  
  
    ggmap(ak_goa_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ber_mag, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Berryteuthis magister abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_GOA_bathy_&_berryteuthis_magister_cpue_num_ha_6_years.jpg"))

```

###Ross Pac BS: deepdive thru time
```{r, fig.width = 8, fig.height = 10, echo = FALSE}
# Special Ross Pac BSAI A.1: each color = every 5ish years
    AK_BS_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ross_pac, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Rossia pacifica abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_BSAI_bathy_&_rossia_pacifica_cpue_num_ha_6_years.jpg"))
  
# Special Ross Pac BSAI A.2: each color = every 5ish years, faceted
  
  ggmap(ak_bs_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_gg_ross_pac, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Rossia pacifica abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_BSAI_bathy_&_rossia_pacifica_cpue_num_ha_6_years.jpg"))


```

#### Ross Pac GOA: deepdive thru time

```{r, fig.width = 20, fig.height = 7, echo = FALSE}

# SPecial Ross Pac GOA A.1: each color = every 5ish years, faceted  

    AK_GOA_bathy_plot_slim +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ross_pac, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "Rossia pacifica abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF"))

  ggsave(here::here("figures", "special_GOA_bathy_&_rossia_pacifica_cpue_num_ha_6_years.jpg"))
  
# SPecial Ross Pac GOA A.2: each color = every 5ish years, faceted  
  
    ggmap(ak_goa_map_base) +
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = year_color_bins),
             data = special_GOA_gg_ross_pac, alpha = .5) + 
  labs(x = "Longitude", y = "Latitude",
       title = "Rossia pacifica abundance map separated color coded every 6 years") + 
  scale_color_manual(
      values = c("#FF62BC", "#F8766D", "#D89000", "#39B600", "#00B0F6", "#9590FF")) + 
  facet_wrap(~year_color_bins)

  ggsave(here::here("figures", "special_facet_GOA_bathy_&_rossia_pacifica_cpue_num_ha_6_years.jpg"))

```


## substrate maps
```{r, fig.height = 20, fig.width = 20, echo = FALSE}
# 20.1: bottom type / substrate map with unidentified

  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude,
                   color = bottom_type, fill = bottom_type), 
               data = join_ceph_haul_bottom_data_clean, 
               alpha = 0.75, size = 1.25, shape = 22) +
    labs(x = "Longitude", y = "Latitude",
         title = "Substrate map") +
    scale_color_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))+
    scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))
  
  ggsave(here::here("figures", "substrate_map.jpg"))
  
  
# 20.2 bottom type / substrate map without unidentified
  
  join_ceph_haul_bottom_data_clean_no_unid <- join_ceph_haul_bottom_data_clean %>% 
    dplyr::filter(bottom_type != "Unidentified")
  
  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude,
                   color = bottom_type, fill = bottom_type), 
               data = join_ceph_haul_bottom_data_clean_no_unid, 
               alpha = 0.75, size = 1.25, shape = 22) +
    labs(x = "Longitude", y = "Latitude",
         title = "Substrate map without unidentified substrates") +
    scale_color_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))+
    scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))

  ggsave(here::here("figures", "substrate_map_no_unid.jpg"))
  

# 21.1 bottom type + all distribution map
 
 ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude), 
               data = ceph_data_clean_cpue, alpha = .75, 
               color = "orange", size = 0.75) + 
    geom_point(data = join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   color = bottom_type, fill = bottom_type), 
               alpha = 0.5, size = 1, shape = 22) +
    scale_color_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))+
    scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
    labs(x = "Longitude", y = "Latitude",
         title = "Substrate map + all distribution map") 
  
  ggsave(here::here("figures", "all_distribution_&_substrate_map_no_unid.jpg"))
  
# 21.2 bottom type + all abundance map

  ggmap(ak_map_base) + 
    geom_point(aes(x = start_longitude, y = start_latitude, 
                   size = cpue_num_ha), 
               data = ceph_data_clean_cpue, 
               color = "darkred", alpha = .33) +
    geom_point(data = join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   color = bottom_type, fill = bottom_type), 
               alpha = 0.5, size = 1, shape = 22) +
      scale_color_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black"))+
    scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
    labs(x = "Longitude", y = "Latitude",
         title = "Substrate map + all abundance map") 
  
  ggsave(here::here("figures", "all_abundance_&_substrate_map_no_unid.jpg"))
  
  
# 21.3 bottom type + family distribution map
  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = family_taxon), 
             data = ceph_data_clean_cpue, alpha = .75, 
             size = 1) + 
  geom_point(data = join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   fill = bottom_type), 
               alpha = 0.75, size = 1, shape = 22) +
  scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
  labs(x = "Longitude", y = "Latitude",
       title = "Substrate map + family distribution map")

  ggsave(here::here("figures", "family_distribution_&_substrate_map_no_unid.jpg"))
  
# 21.4 bottom type + family abundance map
  ggmap(ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = family_taxon,
                 size = cpue_num_ha), 
             data = ceph_data_clean_cpue, alpha = .33) + 
  geom_point(data = join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   fill = bottom_type), 
               alpha = 0.5, size = 1, shape = 22) +
  scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
  labs(x = "Longitude", y = "Latitude",
       title = "Substrate map + family abundance map")

  ggsave(here::here("figures", "family_abundance_&_substrate_map_no_unid.jpg"))
  
# 22.1 bottom type + bathymetry
tidy_join_ceph_haul_bottom_data_clean_no_unid <- join_ceph_haul_bottom_data_clean_no_unid %>% 
  dplyr::filter(start_longitude < 0 & region != "WC" & region != "HWC")
  
  
AK_bathy_plot +
  geom_point(data = tidy_join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   color = bottom_type), 
               alpha = 0.75, size = 1, shape = 22) +
  scale_color_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) 

  ggsave(here::here("figures", "bathymetry_&_substrate_map_no_unid.jpg"))
  

```

```{r, fig.height = 8, fig.width = 15, echo = FALSE}
# 21.5 bottom type + top 7 abundance map

  pres_AK_location <- c(-180, 50, -130, 65)
  
  pres_ak_map_base <- get_map(location = pres_AK_location, source = "stamen", 
                         maptype = "toner-lite", crop = FALSE)
    
  pres_join_ceph_haul_bottom_data_clean_no_unid <- join_ceph_haul_bottom_data_clean_no_unid %>% 
    dplyr::filter(start_longitude < -130)
  
  
  ggmap(pres_ak_map_base) + 
  geom_point(aes(x = start_longitude, y = start_latitude, 
                 color = report_name_scientific,
                 size = cpue_num_ha), 
             data = gg_7_ceph_data_clean, alpha = .33) + 
  geom_point(data = pres_join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   fill = bottom_type), 
               alpha = 0.5, size = 1, shape = 22) +
  scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
  labs(x = "Longitude", y = "Latitude",
       title = "Substrate & Top 7 Species Abundance Map",
       fill = "Bottom Type", color = "Report Name Scientific", size = "CPUE, Number per Hectare")

  ggsave(here::here("figures", "top_7_abundance_&_substrate_map_no_unid.jpg"))
```

## BS Slope Suite
### slope bathy maps
```{r, fig.width = 12, fig.height = 15, echo = FALSE}
# 22.1 bathy + top 5 (B. leioderma, E. dofleini, G. borealis, B. magister, S. salebrosus)

  AK_BS_bathy_plot_slim +
  geom_point(aes(x = longitude, y = latitude,
                 size = cpue_num_ha, color = report_name_scientific),
             data = gg_5_clean_slope_octo_squid, alpha = .75) + 
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "BS Slope Octo and Squid CPUE_num_ha + bathymetry all time") +
  scale_color_manual(
    values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")
  )

  ggsave(here::here("figures", "BS_slope_bathy_octo_squid.jpg"))

# 22.2 bathy + top 7 from pres_ggmar_7ceph_data_clean but only the years that overlap with BS slope surveys (2002, 2004, 2008, 2010, 2012, 2016)
  
  AK_BS_bathy_plot_slim + 
  geom_point(aes(x = start_longitude, y = start_latitude,
                 size = cpue_num_ha, color = report_name_scientific),
             data = comp_ggmar_7_ceph_data_clean, alpha = .75) +
  labs(x = "Longitude", y = "Latitude", fill = "Elevation",
       title = "BS normal survey, CPUE_num_ha + bathymetry 
                (2002, 2004, 2008, 2010, 2012, 2016)" )
  
  ggsave(here::here("figures", "BS_norm_bathy_special_years.jpg"))
    
  
```

### bottom type maps
```{r, fig.width = 10, fig.height = 15, echo = FALSE}
# 23.1 bottom type (BS Slope) + top 5 of BS Slope

  BS_slope_AK_location <- c(-180, 53, -160, 60)
  
  BS_slope_ak_map_base <- get_map(location = BS_slope_AK_location, source = "stamen", 
                                  maptype = "toner-lite", crop = FALSE)


  ggmap(BS_slope_ak_map_base) + 
    geom_point(aes(x = longitude, y = latitude, 
                   size = cpue_num_ha, color = report_name_scientific), 
               data = gg_5_clean_slope_octo_squid, alpha = .75) +
    geom_point(data = join_ceph_haul_bottom_data_clean_no_unid,
               aes(x = start_longitude, y = start_latitude,
                   fill = bottom_type), 
               alpha = 0.5, size = 1, shape = 22) +
    scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC"))+
    scale_fill_manual(
      values = c("red", "bisque", "hotpink2", "yellow", "chartreuse", "purple", "blue", "black")) +
    labs(x = "Longitude", y = "Latitude",
         title = "Substrate map + BS slope species abundance map") 
  
  ggsave(here::here("figures", "BS_slope_abundance_&_substrate_map_no_unid.jpg"))

```

### bottom temperature graphs
```{r, fig.width = 24, fig.height = 12, echo = FALSE}
# 24.1 normal map (no bathy) bottom temp
  # color = species, shape = species, alpha = temperature bins, fill = temperature bins

  ggmap(BS_slope_ak_map_base) + 
    geom_point(aes(x = longitude, y = latitude, color = report_name_scientific), 
               data = gg_5_clean_slope_octo_squid, alpha = .75, size = 2.5) +
  
    geom_point(aes(x = longitude, y = latitude, fill = bot_temp_color_bins),
               data = slope_octo_squid_bot_temp_bin, alpha = 0.5, size = 1.35, shape = 21)+
  
  scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC"))+
  scale_fill_manual(values = c("blue", "#006600", "#CC6600", "#FFCC00", "firebrick4", "black")) +

      labs(x = "Longitude", y = "Latitude",
         title = "BS Slope Species and Bottom temp  map") + 
  facet_wrap(~year)

  ggsave(here::here("figures", "BS_slope_abundance_&_bot_temp.jpg"))

    
# 24.2 bathy map w/ bottom temp DEFUNCT

  # AK_BS_bathy_plot_slim + 
  #   geom_point(aes(x = longitude, y = latitude,
  #                  color = bot_temp_color_bins),
  #              data = slope_octo_squid_bot_temp_bin, alpha = .5) +
  #   labs(x = "Longitude", y = "Latitude", fill = "Elevation",
  #        title = "BS slope bot temp + bathymetry (2002, 2004, 2008, 2010, 2012, 2016)")+
  #   scale_color_manual(values = c("red", "blue", "green", "yellow", "purple", "black"))+
  #   facet_wrap(~year)
  #   
  #   ggsave(here::here("figures", "BS_slope_bot_temp_&_bathy.jpg"))
  

# 24.3 graph of species vs temperature (facet year?)
  
  ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = report_name_scientific, y = gear_temperature, size = cpue_num_ha)) + 
    geom_point(aes(color = bot_temp_color_bins, fill = bot_temp_color_bins)) + 
      scale_fill_manual(values = c("blue", "#006600", "#CC6600", "#FFCC00", "firebrick4", "black")) +
      scale_color_manual(values = c("blue", "#006600", "#CC6600", "#FFCC00", "firebrick4", "black")) +
    labs(title = "BS Slope bottom temp vs species")
  
  ggsave(here::here("figures", "BS_slope_species_vs_bot_temp.jpg"))
  
# 24.4 graph of temperature vs depth (group by species)
  ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species") + 
    expand_limits(x = 0, y = c(-4, 8)) +
    scale_y_continuous(breaks = c(-4, 0, 4, 8))
  
  ggsave(here::here("figures", "BS_slope_smooth_conf_species_vs_bot_temp.jpg"))
  
  # no zoom in on the data (makes temperature curve more pronounced)
  ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species") + 
    expand_limits(x = 0) 

  
  ggsave(here::here("figures", "BS_slope_smooth_conf_species_vs_bot_temp_zoom.jpg"))

    
  # left out confidence interval, thouhts?  
  ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(se = FALSE, aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species")+ 
    expand_limits(x = 0)
  
  ggsave(here::here("figures", "BS_slope_smooth_no_conf_species_vs_bot_temp.jpg"))
  
  
  # facet by year, with conf
    ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species")+
      facet_wrap(~year)+ 
    expand_limits(x = 0)
  
  ggsave(here::here("figures", "BS_slope_smooth_conf_facet_year_species_vs_bot_temp.jpg"))
  
  
  # facet by year, no conf
    ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(se = FALSE, aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species")+
      facet_wrap(~year)+ 
    expand_limits(x = 0)
  
  ggsave(here::here("figures", "BS_slope_smooth_no_conf_facet_year_species_vs_bot_temp.jpg"))
  
  
  # only points, no trendline 
  ggplot(data= slope_octo_squid_bot_temp_bin,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) + 
      scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
      scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    labs(title = "BS Slope bottom temp vs species")+ 
    expand_limits(x = 0)
  
  ggsave(here::here("figures", "BS_slope_point_species_vs_bot_temp.jpg"))
  
  
# 24.4a bs shelf version
  ggplot(data= bs_shelf_ggmar_7_ceph_data_clean,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
    labs(title = "BS Shelf bottom temp vs species")
  
  ggsave(here::here("figures", "BS_shelf_smooth_conf_species_vs_bot_temp.jpg"))
  
# bs shelf facet by year
    ggplot(data= comp_ggmar_7_ceph_data_clean,
         aes(x = bottom_depth, y = gear_temperature, group = report_name_scientific)) + 
    geom_smooth(aes(color = report_name_scientific, fill = report_name_scientific)) + 
    geom_point(aes(color = report_name_scientific, fill = report_name_scientific, size = cpue_num_ha)) +
    labs(title = "BS Shelf bottom temp vs species")+
      facet_wrap(~year) 

  ggsave(here::here("figures", "BS_shelf_smooth_facet_year_species_vs_bot_temp.jpg"))  

  
```

### BS slope and shelf count vs depth graphs
```{r, echo = FALSE}
# 26.1 BS Slope, count vs depth
  # x = depth, y = cpue_num_ha, color = species, facet = year

ggplot(data = slope_octo_squid_bot_temp_bin,
       aes(x = bottom_depth, y = cpue_num_ha)) +
  geom_point(aes(color = report_name_scientific, fill = report_name_scientific),
             alpha = 0.35) +
  geom_smooth(se = FALSE, aes(color = report_name_scientific, fill = report_name_scientific)) + 
  labs(title = "BS Slope depth vs cpue_num_ha, facet by year")+ 
    scale_fill_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
    scale_color_manual(values = c("#F8766D", "#D89000", "#39B600", "#00BF7D", "#FF62BC")) +
  facet_wrap(~year)+
  theme(panel.spacing = unit(2, "lines"))+
  expand_limits(x = 0) + 
  scale_y_continuous(trans = 'log2')

ggsave(here::here("figures", "BS_slope_depth_vs_cpue_num_ha.jpg"))


# 26.2 BS Shelf, count vs depth

ggplot(data = bs_shelf_ggmar_7_ceph_data_clean,
       aes(x = bottom_depth, y = cpue_num_ha)) + 
  geom_point(aes(color = report_name_scientific, fill = report_name_scientific),
             alpha = 0.35) + 
  geom_smooth(se = FALSE, aes(color = report_name_scientific, fill = report_name_scientific)) + 
  labs(title = "BS Shelf depth vs cpue_num_ha, facet by year")+ 
  facet_wrap(~year)+
  theme(panel.spacing = unit(2, "lines"))+
  expand_limits(x = 0) + 
  scale_y_continuous(trans = 'log2')

ggsave(here::here("figures", "BS_shelf_depth_vs_cpue_num_ha.jpg"))

```


### BS shelf vs BS slope graph

```{r, echo = FALSE}

# 25.1 graph comparing numbers from BS norm vs BS slope
  # x = year, y = cpue_num_ha, color = species, facet = region

ggplot(data = all_bs_data,
       aes(x = year, y = cpue_num_ha)) +
  geom_col(aes(color = report_name_scientific, fill = report_name_scientific)) + 
  labs(title = "cpue_num_ha vs year, facet by region") + 
  facet_wrap(~region)

ggsave(here::here("figures", "BS_slope_vs_shelf_cpue_num_ha.jpg"))



```


## akgf maps
``` {r, echo = FALSE } 
# 
# USING AKGFMAPS
  # need help to not need CPUE in final mapping

# Base: making akgf maps with our data

SEBS <- get_base_layers(select.region = "bs.all", set.crs = "auto")
class(SEBS)
names(SEBS)

(SEBS_plot <- ggplot() +
    geom_sf(data = SEBS$akland) +
  geom_sf(data = SEBS$bathymetry) +
  geom_sf(data = SEBS$survey.area, fill = NA) +
  geom_sf(data = SEBS$graticule, color = "grey70", alpha = 0.5) +
  coord_sf(xlim = SEBS$plot.boundary$x,
           ylim = SEBS$plot.boundary$y) +
  scale_x_continuous(name = "Longitude",
                     breaks = SEBS$lon.breaks) +
  scale_y_continuous(name = "Latitude",
                     breaks = SEBS$lat.breaks) +
  theme_bw())

# New Special 1: all ceph CPUE_KGHA map, all time

ebs_all <- get_base_layers(select.region = "bs.all", set.crs = "EPSG:3338")

all_spec_CPUE_KGHA_map <- make_idw_map(x = all_spec,
               region = "bs.all",
               set.breaks = "jenks",
               in.crs = "+proj=longlat",
               out.crs = "EPSG:3338",
               grid.cell = c(20000, 20000),
               key.title = "all Ceph Species",
               use.survey.bathymetry = TRUE) 
  # geom_sf(data = ebs_all$bathymetry) 

# create_map_file(x = all_spec_CPUE_KGHA_map, 
#                 file.prefix = NA,
#                 file.path = here::here("figures", "all_spec_CPUE_KGHA_map_"))

all_spec_CPUE_KGHA_map$plot

```

## correlator
```{r, echo = FALSE}
# c1: BS slope abundance vs depth correlation test, B mag only

ggplot(data = bs_slope_b_mag,
       aes(x = bottom_depth, y = cpue_num_ha)) + 
  geom_point() + 
  labs(title = "BS Slope cpue_num_ha vs depth correlation test",
       subtitle = "Berryteuthis magister only") + 
  scale_y_continuous(trans = 'log10')

ggsave(here::here("figures", "c1_cpue_num_ha_vs_depth.jpg"))

cor.test(bs_slope_b_mag$bottom_depth, bs_slope_b_mag$cpue_num_ha)
  # cor = -0.2262274

cov(bs_slope_b_mag$bottom_depth, bs_slope_b_mag$cpue_num_ha)
  # cov = -162.1452

# c2: BS slope abundance vs gear temp correlation test, B mag only

ggplot(data = bs_slope_b_mag,
       aes(x = gear_temperature, y = cpue_num_ha)) + 
  geom_point() + 
  labs(title = "BS Slope cpue_num_ha vs bottom temp correlation test",
       subtitle = "Berryteuthis magister only")  
  # scale_y_continuous(trans = 'log10')

ggsave(here::here("figures", "c2_cpue_num_ha_vs_gear_temp.jpg"))

cor.test(bs_slope_b_mag$gear_temperature, bs_slope_b_mag$cpue_num_ha)
  # cor = 0.1016777

cov(bs_slope_b_mag$gear_temperature, bs_slope_b_mag$cpue_num_ha)
  # cov = NA

# c3: BS slope catch gear temp vs catch bottom depth correlation test, B mag only

ggplot(data = bs_slope_b_mag,
       aes(x = bottom_depth, y = gear_temperature)) + 
  geom_point(aes(size = cpue_num_ha),
             alpha = 0.33) + 
  labs(title = "BS Slope bottom depth vs bottom temp correlation test",
       subtitle = "Berryteuthis magister only")+
  facet_wrap(~year)

ggsave(here::here("figures", "c3_bottom_depth_vs_gear_temp.jpg"))

cor.test(bs_slope_b_mag$gear_temperature, bs_slope_b_mag$bottom_depth)
  # cor = = -0.3633621


cov(bs_slope_b_mag$gear_temperature, bs_slope_b_mag$bottom_depth)
  # cov = NA


cor(bs_slope_b_mag[,18:23], bs_slope_b_mag[,18:23], use="complete.obs")


bs_slope_b_mag_2002 <- bs_slope_b_mag %>% 
  dplyr::filter(year == 2002)

cor.test(bs_slope_b_mag_2002$gear_temperature, bs_slope_b_mag_2002$bottom_depth, use = "complete.obs")

bs_slope_b_mag_2016 <- bs_slope_b_mag %>% 
  dplyr::filter(year == 2016)

cor.test(bs_slope_b_mag_2016$gear_temperature, bs_slope_b_mag_2016$bottom_depth, use = "complete.obs")
```
















